# Overview
This document describes a user experience and graphical user interface for a BitShares user of recurring withdrawals. Two types of users are addressed: the user who grants authorization for recurring withdrawals (giver), and the user who might requests authorization and who performs authorized withdrawals (recipient).

[Most of the needed functionality](https://github.com/bitshares/bitshares-core/issues/540) is already implemented in BitShares Core. A recurring withdrawal is defined by the following:

- Account authorizing the withdrawal
- Account authorized to withdraw
- Starting date-time
- Maximum amount of an asset per period
- Number of periods (implies an ending date-time)
- Optional Information (potentially in "extensions")

There are two general sequences for recurring withdrawals.

**Giver-Initiated Sequence**
1. A giver creates a recurring withdrawal authorization
2. A recipient performs either partial or maximum withdrawals periodically

or

**Recipient-Initiated Sequence**
1. A potential recipient requests a recurring withdrawal authorization
2. A potential giver reviews the request
3. The potential giver accepts the request and grants authorization
4. A recipient performs either partial or maximum withdrawals periodically


# User Experience
## User Experience for Giver
### Manual Request Process (Giver-Initiated Sequence only)
1. Selects a recurring withdrawal amount, interval period, maximum number of periods, and the account name of the potential giver
2. Creates/submits the recurring withdrawal to the blockchain
3. Optionally notify the recipient about the authorization


### Review Authorization Request Process (Recipient-Initiated Sequence only)
During the authorization process, a user is visiting the web site of a third-party (such as a merchant, a charity, friend, or family member) that is requesting authorization for recurring withdrawals.

#### Process A
Context: User does not trust the requesting website to safely link to a BitShares web wallet

1. User is on a requestor web site; selects a recurring withdrawal amount, interval period, maximum number of periods
2. User is prompted to specify their BitShares account ID; requestor submits a proposed transaction for recurring withdrawals that only becomes active if approved by user
3. Requestor website prompts user to go to their favorite BitShares web wallet (that can handle recurring withdrawals) to approve the request. Requestor website continues to monitor the blockchain.
4. User goes to their wallet, reviews all requests for recurring withdrawals. Selects the specific recurring withdrawal from this requestor.
5. User reviews the request.  If user authorizes, user is then shown confirmation and an optional requestor message or requestor URL that was **provided in the proposed withdrawal_create_operation in the proposed transaction from Step 2**.  If a URL is provided, consider permitting the user to click on the URL (unless security concerns suggest otherwise).
6. User returns to the request web site



#### Process B
Context: User does trust the requestor website to safely link to a BitShares web wallet; requestor prepares a proposed transaction for review by user

1. User is on a requestor web site; selects a recurring withdrawal amount, interval period, maximum number of periods
2. User is prompted to specify their BitShares account ID; requestor submits a proposed transaction for recurring withdrawals that only becomes active if approved by user
3. Requestor website displays graphical links to BitShares web wallets that support recurring withdrawals. The link embeds within it the ID of the proposed transaction that needs to be reviewed. Requestor website continues to monitor the blockchain.
4. User clicks on web wallet link that has embedded in it the proposed transaction that requires review.
5. User reviews the request.  If user authorizes, user is then shown confirmation and an optional requestor message or requestor URL that was **provided in the URL from Step 2**.  If a URL is provided, consider permitting the user to click on the URL (unless security concerns suggest otherwise).
6. User is automatically redirected to the requestor web site after several seconds.


#### Process C
Context: User does trust the requestor website to safely link to a BitShares web wallet; requestor embeds details about the recurring withdrawal in URL to allow user's wallet to create the recurring withdrawal (no use of proposed transaction)

1. User is on a requestor web site; selects a recurring withdrawal amount, interval period, maximum number of periods
2. Requestor website displays graphical links to BitShares web wallets that support recurring withdrawals. The link embeds within it details about the recurring withdrawal, a URL for supplemental information to be displayed in the request screen, a URL to redirect to after authorization. Requestor website does not need to monitor the blockchain.
3. User clicks on web wallet link that has embedded in it details to construct the recurring withdrawal request along with supplemental information from the requestor.
4. Wallet appears and constructs a recurring withdrawal authorization from the data in the URL. Wallet presents the authorization to the user.
5. User reviews the request.  If user authorizes, user is then shown confirmation and an optional requestor message or requestor URL that was **provided in the URL from Step 2**.  If a URL is provided, consider permitting the user to click on the URL (unless security concerns suggest otherwise).
6. User is automatically redirected to the requestor web site after several seconds.


## User Experience for Recipient

### Request Authorization Process with Proposed Transactions (Giver-Initiated Sequence  only: Process A)
A potential recipient requests a potential giver to grant authorization for future recurring withdrawals. The following UX is within the reference wallet

1. Selects a recurring withdrawal amount, interval period, maximum number of periods, and the account name of the potential giver
2. Creates a proposed transaction
3. Awaits review by giver; monitors blockchain


### Withdrawal Process
An authorized party may enter the wallet to view their current authorizations, and to manually perform an authorized withdrawal. The following UX is within the reference wallet

1. View list of authorized recurring withdrawals
2. Select a particular authorization
3. View a particular authorization
4. If possible, withdraw an amount



# Graphical User Interface (UI)

## Overview
A place in the reference wallet where the various screens are listed
- View authorizations

Displays "Authorizations **by** Account"

- View withdrawals

Displays "Withdrawals from Account"


## Authorizations **by** Account
Buttons/tabs/links to see the following
- Active authorizations

Displays "Ongoing Recurring Withdrawal **Granted by** Account"

- Expired authorizations

Displays "Expired Withdrawal Authorizations **Granted by** Account"

- Requests for new authorization

Displays "All Pending Authorization Requests"



## Withdrawals **from** Account
Similar to "Bottom section" of Detail View but with supplemental information

Multiple rows of past withdrawals sorted in reverse chronological order. Each row contains:
- Date
- Amount
- Account of withdrawer/requestor
- ID of active or expired authorization (links to detail view)


## Authorizations **to** Account
Reference wallet probably needs the "opposite view" for recipients


## Reviewing Ongoing Recurring Withdrawal **Granted by** Account
A table with multiple rows for ongoing recurring withdrawal. Each row contains:
- Which requestor has been authorized
- Maximum amount to withdraw per period
- Period description
- Last withdrawal (amount and date)
- Link to "Detail View"

## Expired Authorizations **Granted by** Account
- Who was authorized
- When was authorization granted
- Period
Maximum amount of an asset per period 

## Reviewing Ongoing Recurring Withdrawal **Granted to** Account
A table with multiple rows for ongoing recurring withdrawal. Each row contains:
- Which requestor has been authorized
- Maximum amount to withdraw per period
- Period description
- Last withdrawal (amount and date)
- Link to "Detail View"



## Detail View (for a Single Recurring Withdrawal Authorization)
### Top section
- Account authorizing the withdrawal
- When was authorization granted
- Account authorized to withdraw
- Maximum amount of an asset per period
- Starting date
- Number of periods
- Starting on date and ending on date
- Optional Withdrawal Information (e.g. URL from a vendor)

(If Active)
- Current Period Ends
- Amount already withdrawn this period
- Amount that could still be withdrawn this period

Cancel authorization button

(/If Active)

(If Not Active)
- Expired on <implied ending date>

(/If Not Active)


### Bottom section
(multiple rows of past withdrawals sorted in reverse chronological order)
- Date
- Amount
- Account of withdrawer


## All Pending Authorization Requests
View list of pending withdrawal requests as multiple rows. Each row contains:
- Who is requesting authorization
- Maximum amount of an asset per period
- Number of periods
- Starting on date and ending on date
- "View request" link

If user clicks on "View Authorization Request", switch to "Single Authorization Request" view


## Single Authorization Request (Recipient-Initiated Process only)
- Who is requesting authorization
- Maximum amount of an asset per period
- Starting date
- Number of periods
- Starting on date and ending on date
- Optional Withdrawal Information (e.g. URL from a vendor)

Authorize button

If user clicks on "authorize", display a confirmation box.  If confirms, (1) display confirmation message, (2) change authorize button to "Authorized" link which user can click on to go to the Detail view.


## Create Authorization (Giver-Initiated Process only)

- Account authorizing the withdrawal (filled in to current account in wallet)
- Account authorized to withdraw
- Maximum amount of an asset per period
- Starting date
- Number of periods (displays implied ending date)
- Optional Withdrawal Information (e.g. URL from a vendor)

Authorize button

If user clicks on "authorize", display a confirmation box.  If confirms, (1) display confirmation message, (2) change authorize button to "Authorized" link which user can click on to go to the Detail view.


## Create Authorization Request (Recipient-Initiated Process only)

- Account authorizing the withdrawal
- Account authorized to withdraw (filled in to current account in wallet)
- Maximum amount of an asset per period
- Starting date
- Number of periods (displays implied ending date)
- Optional Withdrawal Information (e.g. URL from a vendor)

Create Request button

If user clicks on button, displays a confirmation box, displays proposal ID, and possibly displays a URL that the potential giver may use to review the request in a reference wallet.

# Discussion
[UX Add support for recurring payments](https://github.com/bitshares/bitshares-ui/issues/30)

[General Idea: New Functionality to Realize Recurring/Scheduled Withdrawals on BitShares](https://github.com/bitshares/bitshares-core/issues/540)
